#!/usr/bin/env bash

set -e

cd "$(dirname "$0")/.."

# Check if Ruby is installed
if ! command -v ruby &> /dev/null; then
  echo "Error: Ruby is not installed."
  echo ""
  echo "Please install Ruby first:"
  echo "  - macOS: brew install ruby"
  echo "  - Linux: Use your package manager (apt, yum, etc.)"
  echo "  - Or visit: https://www.ruby-lang.org/en/documentation/installation/"
  echo ""
  exit 1
fi

echo "Ruby $(ruby -v) detected."
echo ""
echo "Setting up all API services..."
echo ""

for api_dir in *_api; do
  if [ -d "$api_dir" ] && [ -f "$api_dir/bin/setup" ]; then
    echo "Running setup for $api_dir..."
    cd "$api_dir"
    ./bin/setup
    cd ..
    echo ""
  fi
done

echo "All API services setup complete!"
